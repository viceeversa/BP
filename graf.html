import pandas as pd
import plotly.express as px
import plotly.graph_objects as go

# Dáta
data = {
    'Názov politického subjektu': [
        'Progresívne Slovensko', 
        'OĽANO A PRIATELIA', 
        'Sloboda a Solidarita', 
        'Slovenská národná strana', 
        'SMER - sociálna demokracia', 
        'HLAS - sociálna demokracia', 
        'Kresťanskodemokratické hnutie'
    ],
    'Počet platných hlasov': [533136, 264137, 187645, 166995, 681017, 436415, 202515],
    'Počet mandátov podľa RVČ': [32, 16, 11, 10, 41, 26, 12],
    'Počet kandidátov': [150, 150, 150, 150, 150, 150, 150]  # Vždy 150
}

# Vytvorenie DataFrame
df = pd.DataFrame(data)

# Usporiadanie podľa počtu hlasov (od najväčšieho po najmenšie)
df = df.sort_values(by='Počet platných hlasov', ascending=False)

# Použitie palety Viridis
#Purple, Plasma', 'Blues', 'Sunsetdark', 'Darkmint'
colors = px.colors.sequential.Viridis

# Vytvorenie farebného kľúča na základe politických subjektov
color_map = {subjekt: colors[i % len(colors)] for i, subjekt in enumerate(df['Názov politického subjektu'])}

# 📊 Interaktívny stĺpcový graf - Počet mandátov
fig_bar = px.bar(df, 
                 x='Názov politického subjektu', 
                 y='Počet mandátov podľa RVČ',
                 hover_data={'Počet platných hlasov': True},
                 labels={'Počet mandátov podľa RVČ': 'Počet mandátov'},
                 title='Počet mandátov pre politické subjekty',
                 color='Názov politického subjektu',
                 color_discrete_map=color_map)

fig_bar.update_traces(marker=dict(line=dict(width=1, color='black')), opacity=0.9)
fig_bar.update_layout(yaxis_title="Počet mandátov")

# 🥧 Koláčový graf (percentuálne rozdelenie hlasov)
fig_pie = px.pie(df, 
                 names='Názov politického subjektu', 
                 values='Počet platných hlasov', 
                 title='Percentuálne rozdelenie hlasov medzi subjekty',
                 color='Názov politického subjektu',
                 color_discrete_map=color_map,
                 hole=0.4)

fig_pie.update_traces(
    textinfo='percent+label',
    hoverinfo='label+percent+value',
    pull=[0.1 if x == df['Názov politického subjektu'].iloc[0] else 0 for x in df['Názov politického subjektu']]
)

# 🎯 Scatter plot - Porovnanie hlasov a mandátov
fig_scatter = px.scatter(df,
                         x='Počet platných hlasov',
                         y='Počet mandátov podľa RVČ',
                         size='Počet kandidátov',
                         color='Názov politického subjektu',
                         title='Porovnanie počtu hlasov a získaných mandátov',
                         color_discrete_map=color_map,
                         hover_name='Názov politického subjektu')

fig_scatter.update_layout(xaxis_title="Počet platných hlasov", yaxis_title="Počet mandátov")

# Zobrazenie grafov
fig_bar.show()
fig_pie.show()
fig_scatter.show()

# Uloženie grafov ako HTML
fig_bar.write_html("graf_bar.html")
fig_pie.write_html("graf_pie.html")
fig_scatter.write_html("graf_scatter.html")
